{"ast":null,"code":"import _slicedToArray from \"/Users/thinh/Desktop/timechart/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/thinh/Desktop/timechart/src/components/SubjectPicker.js\";\nimport React, { useState, useEffect, useRef } from 'react';\nimport { render } from '@testing-library/react';\nimport '../css/SubjectPicker.css';\nimport Classnames from 'classnames';\nimport axios from 'axios';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { setTimetable, setListSubject, unsetListSubject, setChosenSubject, unsetChosenSubject, setValidTimetable, setIsValidTimetable } from '../actions/index';\n\nfunction SubjectPicker() {\n  const _useState = useState([]),\n        _useState2 = _slicedToArray(_useState, 2),\n        searchData = _useState2[0],\n        setSearchData = _useState2[1];\n\n  const chosenSubjectText = useRef(\"\");\n  const listSubject = useSelector(state => state.listSubjects);\n  const chosenSubject = useSelector(state => state.chosenSubjects);\n  const validMatrix = useSelector(state => state.validMatrix);\n  const isValidTimetable = useSelector(state => state.isValidTimetable);\n  const timeOutObj = useRef();\n  const dispatch = useDispatch();\n  useEffect(() => {\n    axios.get('http://localhost:7000/api/subjects').then(res => {\n      dispatch(setListSubject(res.data.subjects));\n      setSearchData(res.data.subjects);\n    }).catch(err => {\n      throw err;\n    });\n  }, []);\n\n  function renderListSubject(data) {\n    return React.createElement(\"li\", {\n      key: data.id,\n      style: {\n        cursor: 'pointer'\n      },\n      onClick: onSubjectClickHandle.bind(this, data),\n      className: Classnames(\"list-subject border-left-0 rounded-0 border-right-0 border-top-0 list-group-item\", \"list-subject border-left-0 rounded-0 border-right-0 border-top-0 list-group-item\", {\n        \"custom-active\": chosenSubject.find(e => e._id === data._id)\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 33\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 34\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      className: \"pr-3 font-weight-bolder\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 35\n      },\n      __self: this\n    }, data.code), React.createElement(\"span\", {\n      className: \"pr-3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 36\n      },\n      __self: this\n    }, data.name), React.createElement(\"span\", {\n      className: \"pr-3 font-weight-bold\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 37\n      },\n      __self: this\n    }, data.ecturer), React.createElement(\"span\", {\n      className: \"pr-3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 38\n      },\n      __self: this\n    }, data.credits, \" t\\xEDn ch\\u1EC9\"), React.createElement(\"span\", {\n      className: \"pr-3 text-subject\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 39\n      },\n      __self: this\n    }, \"Th\\u1EE9 \", data.dow === undefined ? '*' : data.dow), React.createElement(\"span\", {\n      className: \"pr-3 text-subject\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 40\n      },\n      __self: this\n    }, \"Ti\\u1EBFt \", data.lessons === \"\" ? '*' : data.lessons), React.createElement(\"span\", {\n      className: \"pr-3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 41\n      },\n      __self: this\n    }, data.lang)));\n  }\n\n  function checkingValid(newSubject) {\n    let tempMatrix = validMatrix;\n    let day = newSubject.dow;\n\n    if (day === undefined || day === '*' || day === null) {\n      dispatch(setValidTimetable(tempMatrix));\n      dispatch(setChosenSubject(newSubject));\n      chosenSubjectText.current = chosenSubjectText.current.concat(newSubject.code + '\\n');\n      return;\n    }\n\n    let lessons = newSubject.lessons === '*' ? null : newSubject.lessons.split('').map(e => {\n      if (e === '0') return 10;\n      return parseInt(e);\n    });\n    tempMatrix[lessons[0] - 1][day - 2] = `<td rowSpan=${lessons.length}>${newSubject.name}</td>`;\n\n    for (let i = 1; i < lessons.length; ++i) {\n      if (tempMatrix[lessons[i] - 1][day - 2] === false) {\n        tempMatrix[lessons[i] - 1][day - 2] = `<td className=\"collapse\">Nothing</td>`;\n      } else {\n        clearTimeout(timeOutObj.current);\n        dispatch(setIsValidTimetable(false));\n        timeOutObj.current = setTimeout(() => {\n          dispatch(setIsValidTimetable(true));\n        }, 5000);\n        return;\n      }\n    }\n\n    dispatch(setValidTimetable(tempMatrix));\n    dispatch(setChosenSubject(newSubject));\n    chosenSubjectText.current = chosenSubjectText.current.concat(newSubject.code + '\\n');\n  }\n\n  function onSubjectClickHandle(data) {\n    if (!chosenSubject.find(e => e._id === data._id)) {\n      if (chosenSubject.find(e => e.name === data.name)) {\n        clearTimeout(timeOutObj.current);\n        dispatch(setIsValidTimetable(false));\n        timeOutObj.current = setTimeout(() => {\n          dispatch(setIsValidTimetable(true));\n        }, 5000);\n      } else {\n        checkingValid(data);\n      }\n    } else {\n      let tempMatrix = validMatrix;\n      let day = data.dow;\n\n      if (day === undefined || day === '*' || day === null) {\n        dispatch(unsetChosenSubject(data));\n        chosenSubjectText.current = chosenSubjectText.current.replace(data.code + '\\n', '');\n        return;\n      }\n\n      let lessons = data.lessons === '*' ? null : data.lessons.split('').map(e => {\n        if (e === '0') return 10;\n        return parseInt(e);\n      });\n\n      for (let i = 0; i < lessons.length; ++i) {\n        tempMatrix[lessons[i] - 1][day - 2] = null;\n      }\n\n      dispatch(unsetChosenSubject(data));\n      chosenSubjectText.current = chosenSubjectText.current.replace(data.code + '\\n', '');\n    }\n  }\n\n  function onSubjectTextHandle(e) {//dispatch(setListSubject(e.target.value));\n  }\n\n  function onButtonClickHandle(e) {\n    dispatch(setTimetable());\n    e.preventDefault();\n  }\n\n  function onSearchChange(e) {\n    let sample = listSubject.filter(data => {\n      if (data.code.toLowerCase().includes(e.target.value.toLowerCase()) || data.name.toLowerCase().includes(e.target.value.toLowerCase())) {\n        return true;\n      }\n\n      return false;\n    });\n    setSearchData(sample);\n  }\n\n  return React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143\n    },\n    __self: this\n  }, React.createElement(\"form\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144\n    },\n    __self: this\n  }, !isValidTimetable ? React.createElement(\"div\", {\n    class: Classnames(\"alert alert-danger animation\"),\n    role: \"alert\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148\n    },\n    __self: this\n  }, \"Th\\xF4ng tin kh\\xF4ng h\\u1EE3p l\\u1EC7 (M\\xF4n h\\u1ECDc \\u0111\\xE3 \\u0111\\u01B0\\u1EE3c \\u0111\\u0103ng k\\xED ho\\u1EB7c th\\u1EDDi gian b\\u1ECB tr\\xF9ng)\") : React.createElement(\"label\", {\n    htmlFor: \"\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153\n    },\n    __self: this\n  }, \"\\u0110i\\u1EC1n m\\xE3 m\\xF4n mu\\u1ED1n \\u0111\\u0103ng k\\xED (m\\u1ED7i m\\xE3 m\\xF4n n\\u1EB1m tr\\xEAn m\\u1ED9t d\\xF2ng)\"), React.createElement(\"textarea\", {\n    value: chosenSubjectText.current,\n    onChange: onSubjectTextHandle,\n    className: \"form-control\",\n    id: \"\",\n    style: {\n      resize: \"none\"\n    },\n    rows: \"5\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155\n    },\n    __self: this\n  }), React.createElement(\"label\", {\n    htmlFor: \"\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156\n    },\n    __self: this\n  }, \"Ch\\u1ECDn m\\xF4n mu\\u1ED1n \\u0111\\u0103ng k\\xED\"), React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }, React.createElement(\"input\", {\n    onChange: onSearchChange,\n    className: \"form-control\",\n    type: \"text\",\n    placeholder: \"Search\",\n    \"aria-label\": \"Search\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"mt-2\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159\n    },\n    __self: this\n  }, React.createElement(\"ul\", {\n    style: {\n      height: '35vh',\n      overflow: 'scroll',\n      overflowX: 'hidden'\n    },\n    className: \"p-2 border rounded list-group\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  }, searchData.map(subject => {\n    if (subject) {\n      return renderListSubject(subject);\n    }\n  })))), React.createElement(\"div\", {\n    className: \"d-flex justify-content-center mt-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    onClick: onButtonClickHandle,\n    className: \"btn btn-dark\",\n    type: \"submit\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171\n    },\n    __self: this\n  }, \"T\\u1EA1o th\\u1EDDi kho\\xE1 bi\\u1EC3u\"))));\n}\n\nexport default SubjectPicker;","map":{"version":3,"sources":["/Users/thinh/Desktop/timechart/src/components/SubjectPicker.js"],"names":["React","useState","useEffect","useRef","render","Classnames","axios","useSelector","useDispatch","setTimetable","setListSubject","unsetListSubject","setChosenSubject","unsetChosenSubject","setValidTimetable","setIsValidTimetable","SubjectPicker","searchData","setSearchData","chosenSubjectText","listSubject","state","listSubjects","chosenSubject","chosenSubjects","validMatrix","isValidTimetable","timeOutObj","dispatch","get","then","res","data","subjects","catch","err","renderListSubject","id","cursor","onSubjectClickHandle","bind","find","e","_id","code","name","ecturer","credits","dow","undefined","lessons","lang","checkingValid","newSubject","tempMatrix","day","current","concat","split","map","parseInt","length","i","clearTimeout","setTimeout","replace","onSubjectTextHandle","onButtonClickHandle","preventDefault","onSearchChange","sample","filter","toLowerCase","includes","target","value","resize","height","overflow","overflowX","subject"],"mappings":"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","sourcesContent":["import React,{useState, useEffect, useRef} from 'react';\nimport { render } from '@testing-library/react';\nimport '../css/SubjectPicker.css';\nimport Classnames from 'classnames';\nimport axios from 'axios';\nimport {useSelector, useDispatch} from 'react-redux';\nimport {setTimetable, setListSubject, unsetListSubject, setChosenSubject, unsetChosenSubject, setValidTimetable, setIsValidTimetable} from '../actions/index';\n\nfunction SubjectPicker() {\n\n    const [searchData, setSearchData] = useState([]);\n    const chosenSubjectText = useRef(\"\");\n    const listSubject = useSelector(state => state.listSubjects);\n    const chosenSubject = useSelector(state => state.chosenSubjects);\n    const validMatrix = useSelector(state => state.validMatrix);\n    const isValidTimetable = useSelector(state => state.isValidTimetable);\n    const timeOutObj = useRef();\n    const dispatch = useDispatch();\n\n    useEffect(() => {\n        axios.get('http://localhost:7000/api/subjects')\n            .then(res => {\n                dispatch(setListSubject(res.data.subjects));\n                setSearchData(res.data.subjects);\n            })\n            .catch(err=>{\n                throw err;\n            })\n    }, []);\n\n    function renderListSubject(data){\n        return(\n            <li key={data.id} style={{cursor: 'pointer'}} onClick={onSubjectClickHandle.bind(this, data)} className={Classnames(\"list-subject border-left-0 rounded-0 border-right-0 border-top-0 list-group-item\", \"list-subject border-left-0 rounded-0 border-right-0 border-top-0 list-group-item\", {\"custom-active\": chosenSubject.find(e => e._id === data._id)})}>\n                <div>\n                    <span className=\"pr-3 font-weight-bolder\">{data.code}</span>\n                    <span className=\"pr-3\">{data.name}</span>\n                    <span className=\"pr-3 font-weight-bold\">{data.ecturer}</span>\n                    <span className=\"pr-3\">{data.credits} tín chỉ</span>\n                    <span className=\"pr-3 text-subject\">Thứ {data.dow === undefined ? '*' : data.dow}</span>\n                    <span className=\"pr-3 text-subject\">Tiết {data.lessons === \"\" ? '*' : data.lessons}</span>\n                    <span className=\"pr-3\">{data.lang}</span>\n                </div>\n            </li>\n        );\n    }\n\n    function checkingValid(newSubject){\n        let tempMatrix = validMatrix;\n        let day = newSubject.dow;\n\n        if(day === undefined || day === '*' || day === null)\n        {\n            dispatch(setValidTimetable(tempMatrix));\n            dispatch(setChosenSubject(newSubject));\n            chosenSubjectText.current = chosenSubjectText.current.concat(newSubject.code + '\\n');\n            return;\n        }\n        let lessons = newSubject.lessons === '*' ? null : newSubject.lessons.split('').map(e => {\n            if(e === '0')\n                return 10;\n            return parseInt(e);\n        });\n\n        tempMatrix[lessons[0] - 1][day-2] = `<td rowSpan=${lessons.length}>${newSubject.name}</td>`;\n\n        for(let i = 1; i < lessons.length; ++i){\n            if(tempMatrix[lessons[i] - 1][day - 2] === false){\n                tempMatrix[lessons[i] - 1][day - 2] = `<td className=\"collapse\">Nothing</td>`;\n            }\n            else{\n                clearTimeout(timeOutObj.current);\n                dispatch(setIsValidTimetable(false));\n                timeOutObj.current = setTimeout(() => {\n                    dispatch(setIsValidTimetable(true));\n                }, 5000);\n                return;\n            }\n        }\n        dispatch(setValidTimetable(tempMatrix));\n        dispatch(setChosenSubject(newSubject));\n        chosenSubjectText.current = chosenSubjectText.current.concat(newSubject.code + '\\n');\n    }\n\n    function onSubjectClickHandle(data) {\n        if(!chosenSubject.find(e => e._id === data._id)){\n            if(chosenSubject.find(e => e.name === data.name)){\n                clearTimeout(timeOutObj.current);\n                dispatch(setIsValidTimetable(false));\n                timeOutObj.current = setTimeout(() => {\n                            dispatch(setIsValidTimetable(true));\n                        }, 5000);\n            }\n            else{\n                checkingValid(data);\n            }\n        }\n        else{\n            let tempMatrix = validMatrix;\n            let day = data.dow;\n\n            if(day === undefined || day === '*' || day === null)\n            {\n                dispatch(unsetChosenSubject(data));\n                chosenSubjectText.current = chosenSubjectText.current.replace(data.code + '\\n', '');\n                return;\n            }\n            let lessons = data.lessons === '*' ? null : data.lessons.split('').map(e => {\n                if(e === '0')\n                    return 10;\n                return parseInt(e);\n            });\n\n            for(let i = 0; i < lessons.length; ++i){\n                tempMatrix[lessons[i] - 1][day - 2] = null;\n            }\n            \n            dispatch(unsetChosenSubject(data));\n            chosenSubjectText.current = chosenSubjectText.current.replace(data.code + '\\n', '');\n        }\n    }\n\n    function onSubjectTextHandle(e){\n        //dispatch(setListSubject(e.target.value));\n    }\n\n    function onButtonClickHandle(e){\n        dispatch(setTimetable());\n        e.preventDefault();\n    }\n\n    function onSearchChange(e){\n        let sample = listSubject.filter(data => {\n            if(data.code.toLowerCase().includes(e.target.value.toLowerCase())  ||  data.name.toLowerCase().includes(e.target.value.toLowerCase())){\n                return true;\n            }\n            return false;\n        });\n\n        setSearchData(sample);\n    }\n\n    return(\n        <div>\n            <form>\n                {\n                    !isValidTimetable ? \n                    (\n                        <div class={Classnames(\"alert alert-danger animation\")} role=\"alert\">\n                            Thông tin không hợp lệ (Môn học đã được đăng kí hoặc thời gian bị trùng)\n                        </div>\n                    )\n                    :\n                    <label htmlFor=\"\">Điền mã môn muốn đăng kí (mỗi mã môn nằm trên một dòng)</label>\n                }\n                <textarea value={chosenSubjectText.current} onChange={onSubjectTextHandle} className=\"form-control\" id=\"\" style={{resize: \"none\"}} rows=\"5\"/>\n                <label htmlFor=\"\">Chọn môn muốn đăng kí</label>\n                <div>\n                    <input onChange={onSearchChange} className=\"form-control\" type=\"text\" placeholder=\"Search\" aria-label=\"Search\"/>\n                    <div className=\"mt-2\">\n                        <ul style={{height: '35vh', overflow: 'scroll', overflowX: 'hidden'}} className=\"p-2 border rounded list-group\">\n                            {searchData.map(subject => {\n                                if(subject)\n                                {\n                                    return renderListSubject(subject);\n                                }\n                            })}\n                        </ul>\n                    </div>\n                </div>\n                <div className=\"d-flex justify-content-center mt-3\">\n                    <button onClick={onButtonClickHandle} className=\"btn btn-dark\" type=\"submit\">Tạo thời khoá biểu</button>\n                </div>\n            </form>\n        </div>\n    );\n}\n\nexport default SubjectPicker;"]},"metadata":{},"sourceType":"module"}